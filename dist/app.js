var footballApp=angular.module("footballApp",["ui.router","ui.bootstrap"]);
footballApp.config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/dashboard"),e.state("dashboard",{url:"/dashboard",templateUrl:"dashboard-view/dashboard-view.html"}).state("matches",{url:"/matches",templateUrl:"matches-view/matches-view.html"}).state("teams",{url:"/teams",templateUrl:"teams-view/teams-view.html",controller:"TeamsViewCtrl"}).state("team",{url:"/teams/:teamId",templateUrl:"teams-view/team-view.html",controller:"TeamsViewCtrl"}).state("championships",{url:"/championships",templateUrl:"championships-view/championships-view.html",controller:"ChampionshipsViewCtrl"}).state("championship",{url:"/championships/:championshipsId",templateUrl:"championships-view/championship-view.html",controller:"ChampionshipsViewCtrl"})}]);
footballApp.constant("RouteConstants",{championshipsUrl:"http://footballbet.com.ua/api/championships/",teamsUrl:"http://footballbet.com.ua/api/teams/",matchesUrl:"http://footballbet.com.ua/api/matches/",teamLogoUrl:"http://footballbet.com.ua/teams/embl/",championshipLogoUrl:"http://footballbet.com.ua/table/embl/"});
footballApp.factory("DataService",["$http","$q","$filter","$cacheFactory","RouteConstants",function(e,t,r,n,a){var o={},i="teamsByCountry",s="teamKey",h=n("myCache");return o.getChampionships=function(){var r=t.defer();return e.get(a.championshipsUrl).then(function(e){var t=e.data.result;o.getTeams().then(function(e){for(var n=0;n<t.length;n++){for(var o=[],i=0;i<e.length;i++)e[i].id_championship===t[n].id_championship&&o.push(e[i]);t[n].teamList=o.slice(0),t[n].logoImage=a.championshipLogoUrl+t[n].image}r.resolve(t)})}),r.promise},o.getChampionshipById=function(e){var r=t.defer();return o.getChampionships().then(function(t){for(var n=0;n<t.length;n++)if(t[n].id_championship===e){r.resolve(t[n]);break}}),r.promise},o.getTeamById=function(e){var r=t.defer();return o.getTeams().then(function(t){for(var n=0;n<t.length;n++)if(t[n].id_teams===e){r.resolve(t[n]);break}}),r.promise},o.getTeams=function(){var r,n=t.defer();return r=h.get(s),r?n.resolve(r):e.get(a.teamsUrl).then(function(e){for(var t=e.data.result,r=0;r<t.length;r++)t[r].logoImage=a.teamLogoUrl+t[r].emblema;h.put(s,t),n.resolve(t)}),n.promise},o.getTeamsByCountry=function(){var e=t.defer(),r={};return o.getChampionships().then(function(t){for(var n=0;n<t.length;n++)r[t[n].name]=t[n].teamList;h.put(i,r),e.resolve(r)}),e.promise},o.getTeamsByNameOrCountry=function(e){var t,r={},n={};if(t=h.get(i),t&&(n=t),!e)return n;e=e.toUpperCase();for(var a in n){for(var o=n[a],s=[],m=0;m<o.length;m++){var p,f;p=o[m].name.toUpperCase(),f=o[m].city.toUpperCase(),(f.indexOf(e)>=0||p.indexOf(e)>=0)&&s.push(o[m])}s.length&&(r[a]=s.slice(0))}return r},o.getMatches=function(){return e.get(a.matchesUrl)},o}]);
footballApp.filter("html",["$sce",function(t){return function(n){return t.trustAsHtml(n)}}]);
footballApp.directive("championship",function(){return{restrict:"E",templateUrl:"championship/championship.html",replace:!0,scope:{championship:"="}}});
footballApp.controller("ChampionshipsViewCtrl",["$scope","DataService","$stateParams",function(i,p,h){h.championshipsId?p.getChampionshipById(h.championshipsId).then(function(p){i.championship=p}):(i.selectedChampionship=null,p.getChampionships().then(function(p){i.championshipList=p}),i.selectChampionship=function(p){i.selectedChampionship=p})}]);


footballApp.directive("team",function(){return{restrict:"E",templateUrl:"team/team.html",replace:!0,scope:{team:"="}}});
footballApp.controller("TeamsViewCtrl",["$scope","DataService","$stateParams",function(t,e,a){a.teamId?e.getTeamById(a.teamId).then(function(e){t.team=e}):(e.getTeamsByCountry().then(function(e){t.teamListObj=e}),t.$watch("query",function(a,n){t.teamListObj=e.getTeamsByNameOrCountry(a)}))}]);